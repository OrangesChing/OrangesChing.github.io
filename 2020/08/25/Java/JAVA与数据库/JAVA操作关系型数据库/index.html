<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Java操作关系型数据库 | 大橙砸的日常记录</title><meta name="description" content="Java操作关系型数据库"><meta name="keywords" content="概述,ORM框架,JDBC"><meta name="author" content="大橙砸"><meta name="copyright" content="大橙砸"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon2.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Java操作关系型数据库"><meta name="twitter:description" content="Java操作关系型数据库"><meta name="twitter:image" content="https://orangesching.github.io/img/cover/cover.png"><meta property="og:type" content="article"><meta property="og:title" content="Java操作关系型数据库"><meta property="og:url" content="https://orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/"><meta property="og:site_name" content="大橙砸的日常记录"><meta property="og:description" content="Java操作关系型数据库"><meta property="og:image" content="https://orangesching.github.io/img/cover/cover.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/"><link rel="prev" title="MyBatis-plus构造SQL" href="https://orangesching.github.io/2020/08/31/Java/Java与数据库/MyBatis-plus/MyBatis-plus构造SQL/"><link rel="next" title="一些小工具" href="https://orangesching.github.io/2020/08/24/其他/一些小工具/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">大橙砸的日常记录</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/my.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">63</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">31</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#原生JDBC"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">原生JDBC</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#开发步骤"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">开发步骤</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#开发技巧"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">开发技巧</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#连接步骤"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">连接步骤</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#优缺点"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">优缺点</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#池化数据库连接的JDBC"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">池化数据库连接的JDBC</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#池化连接"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">池化连接</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#工具"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">工具</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#开发步骤-1"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">开发步骤</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Hibernate"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Hibernate</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#架构"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">架构</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#开发步骤-2"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">开发步骤</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#准备Hibernate环境"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text">准备Hibernate环境</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建核心配置文件"><span class="toc_mobile_items-number">3.2.2.</span> <span class="toc_mobile_items-text">创建核心配置文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建持久化Java类"><span class="toc_mobile_items-number">3.2.3.</span> <span class="toc_mobile_items-text">创建持久化Java类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建对象-关系映射文件"><span class="toc_mobile_items-number">3.2.4.</span> <span class="toc_mobile_items-text">创建对象-关系映射文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#通过-Hibernate-API-编写访问数据库"><span class="toc_mobile_items-number">3.2.5.</span> <span class="toc_mobile_items-text">通过 Hibernate API 编写访问数据库</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#创建会话Session"><span class="toc_mobile_items-number">3.2.5.1.</span> <span class="toc_mobile_items-text">创建会话Session</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#创建事务"><span class="toc_mobile_items-number">3.2.5.2.</span> <span class="toc_mobile_items-text">创建事务</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Session-接口方法"><span class="toc_mobile_items-number">3.2.5.3.</span> <span class="toc_mobile_items-text">Session 接口方法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#HQL语法"><span class="toc_mobile_items-number">3.2.5.4.</span> <span class="toc_mobile_items-text">HQL语法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#例子"><span class="toc_mobile_items-number">3.2.5.5.</span> <span class="toc_mobile_items-text">例子</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#MyBatis"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">MyBatis</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#架构-1"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">架构</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#开发步骤-3"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">开发步骤</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#准备MyBatis环境"><span class="toc_mobile_items-number">4.2.1.</span> <span class="toc_mobile_items-text">准备MyBatis环境</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建核心配置文件-1"><span class="toc_mobile_items-number">4.2.2.</span> <span class="toc_mobile_items-text">创建核心配置文件</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建持久化Java类-1"><span class="toc_mobile_items-number">4.2.3.</span> <span class="toc_mobile_items-text">创建持久化Java类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建对象-关系映射、定义SQL语句"><span class="toc_mobile_items-number">4.2.4.</span> <span class="toc_mobile_items-text">创建对象-关系映射、定义SQL语句</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#XML形式"><span class="toc_mobile_items-number">4.2.4.1.</span> <span class="toc_mobile_items-text">XML形式</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#定义动态SQL"><span class="toc_mobile_items-number">4.2.4.1.1.</span> <span class="toc_mobile_items-text">定义动态SQL</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#1-N映射关系定义"><span class="toc_mobile_items-number">4.2.4.1.2.</span> <span class="toc_mobile_items-text">1:N映射关系定义</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#注解形式"><span class="toc_mobile_items-number">4.2.4.2.</span> <span class="toc_mobile_items-text">注解形式</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#映射注解申明sql样例"><span class="toc_mobile_items-number">4.2.4.2.1.</span> <span class="toc_mobile_items-text">映射注解申明sql样例</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#调用定义的SQL"><span class="toc_mobile_items-number">4.2.5.</span> <span class="toc_mobile_items-text">调用定义的SQL</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#MyBatis-plus"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">MyBatis-plus</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#架构-2"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">架构</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#开发步骤-4"><span class="toc_mobile_items-number">5.2.</span> <span class="toc_mobile_items-text">开发步骤</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#环境准备"><span class="toc_mobile_items-number">5.2.1.</span> <span class="toc_mobile_items-text">环境准备</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#配置"><span class="toc_mobile_items-number">5.2.2.</span> <span class="toc_mobile_items-text">配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建实体类"><span class="toc_mobile_items-number">5.2.3.</span> <span class="toc_mobile_items-text">创建实体类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#创建Mapper类或Service类"><span class="toc_mobile_items-number">5.2.4.</span> <span class="toc_mobile_items-text">创建Mapper类或Service类</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Mapper类"><span class="toc_mobile_items-number">5.2.4.1.</span> <span class="toc_mobile_items-text">Mapper类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Service类"><span class="toc_mobile_items-number">5.2.4.2.</span> <span class="toc_mobile_items-text">Service类</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#调用函数操纵数据库"><span class="toc_mobile_items-number">5.2.5.</span> <span class="toc_mobile_items-text">调用函数操纵数据库</span></a></li></ol></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#原生JDBC"><span class="toc-number">1.</span> <span class="toc-text">原生JDBC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#开发步骤"><span class="toc-number">1.1.</span> <span class="toc-text">开发步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发技巧"><span class="toc-number">1.2.</span> <span class="toc-text">开发技巧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接步骤"><span class="toc-number">1.3.</span> <span class="toc-text">连接步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优缺点"><span class="toc-number">1.4.</span> <span class="toc-text">优缺点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#池化数据库连接的JDBC"><span class="toc-number">2.</span> <span class="toc-text">池化数据库连接的JDBC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#池化连接"><span class="toc-number">2.1.</span> <span class="toc-text">池化连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#工具"><span class="toc-number">2.2.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发步骤-1"><span class="toc-number">2.3.</span> <span class="toc-text">开发步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hibernate"><span class="toc-number">3.</span> <span class="toc-text">Hibernate</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#架构"><span class="toc-number">3.1.</span> <span class="toc-text">架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发步骤-2"><span class="toc-number">3.2.</span> <span class="toc-text">开发步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#准备Hibernate环境"><span class="toc-number">3.2.1.</span> <span class="toc-text">准备Hibernate环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建核心配置文件"><span class="toc-number">3.2.2.</span> <span class="toc-text">创建核心配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建持久化Java类"><span class="toc-number">3.2.3.</span> <span class="toc-text">创建持久化Java类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建对象-关系映射文件"><span class="toc-number">3.2.4.</span> <span class="toc-text">创建对象-关系映射文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过-Hibernate-API-编写访问数据库"><span class="toc-number">3.2.5.</span> <span class="toc-text">通过 Hibernate API 编写访问数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建会话Session"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">创建会话Session</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建事务"><span class="toc-number">3.2.5.2.</span> <span class="toc-text">创建事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-接口方法"><span class="toc-number">3.2.5.3.</span> <span class="toc-text">Session 接口方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HQL语法"><span class="toc-number">3.2.5.4.</span> <span class="toc-text">HQL语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子"><span class="toc-number">3.2.5.5.</span> <span class="toc-text">例子</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis"><span class="toc-number">4.</span> <span class="toc-text">MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#架构-1"><span class="toc-number">4.1.</span> <span class="toc-text">架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发步骤-3"><span class="toc-number">4.2.</span> <span class="toc-text">开发步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#准备MyBatis环境"><span class="toc-number">4.2.1.</span> <span class="toc-text">准备MyBatis环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建核心配置文件-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">创建核心配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建持久化Java类-1"><span class="toc-number">4.2.3.</span> <span class="toc-text">创建持久化Java类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建对象-关系映射、定义SQL语句"><span class="toc-number">4.2.4.</span> <span class="toc-text">创建对象-关系映射、定义SQL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XML形式"><span class="toc-number">4.2.4.1.</span> <span class="toc-text">XML形式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#定义动态SQL"><span class="toc-number">4.2.4.1.1.</span> <span class="toc-text">定义动态SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-N映射关系定义"><span class="toc-number">4.2.4.1.2.</span> <span class="toc-text">1:N映射关系定义</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注解形式"><span class="toc-number">4.2.4.2.</span> <span class="toc-text">注解形式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#映射注解申明sql样例"><span class="toc-number">4.2.4.2.1.</span> <span class="toc-text">映射注解申明sql样例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调用定义的SQL"><span class="toc-number">4.2.5.</span> <span class="toc-text">调用定义的SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-plus"><span class="toc-number">5.</span> <span class="toc-text">MyBatis-plus</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#架构-2"><span class="toc-number">5.1.</span> <span class="toc-text">架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发步骤-4"><span class="toc-number">5.2.</span> <span class="toc-text">开发步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境准备"><span class="toc-number">5.2.1.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-number">5.2.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建实体类"><span class="toc-number">5.2.3.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建Mapper类或Service类"><span class="toc-number">5.2.4.</span> <span class="toc-text">创建Mapper类或Service类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper类"><span class="toc-number">5.2.4.1.</span> <span class="toc-text">Mapper类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Service类"><span class="toc-number">5.2.4.2.</span> <span class="toc-text">Service类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调用函数操纵数据库"><span class="toc-number">5.2.5.</span> <span class="toc-text">调用函数操纵数据库</span></a></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/cover/cover.png)"><div id="post-info"><div id="post-title"><div class="posttitle">Java操作关系型数据库</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-08-25<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-06-21</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/Java与数据库/">Java与数据库</a></span><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>JAVA的数据库操作可视为以下演变图，ORM框架中可以加入池化技术，ORM框架的底层都是JDBC实现，只是为了方便开发和解耦封装。</p>
<p><img alt="数据库操作演变" data-src="//orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/数据库操作演变.png" class="lazyload"></p>
<h1 id="原生JDBC"><a href="#原生JDBC" class="headerlink" title="原生JDBC"></a>原生JDBC</h1><p>JDBC是Java数据库连接，全称是Java Database Connectivity，简称JDBC，是Java语言中用来规范客户端程序如何来访问数据库的应用程序接口，提供了诸如查询和更新数据库中数据的方法。JDBC也是Sun Microsystems的商标。我们通常说的JDBC是面向关系型数据库的</p>
<h2 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h2><ol>
<li><p>注册驱动.，告知JVM使用的是哪一个数据库的驱动</p>
<p>-参数：“驱动程序类名”  </p>
<p>-<code>Class.forname(&quot;驱动程序类名&quot;)</code></p>
</li>
<li><p>获得连接.，使用JDBC中的类，完成对MySQL数据库的连接</p>
<p>需要三个参数：<code>url</code>, <code>username</code>, <code>password</code>- 连接到数据库</p>
</li>
<li><p>获得语句执行平台，通过连接对象获取对SQL语句的执行者对象</p>
<p>-<code>conn.getStatemnent()</code>方法创建对象用于执行SQL语句</p>
</li>
<li><p>执行SQL语句，使用执行者对象，向数据库执行SQL语句 获取到数据库的执行后的结果</p>
<p>-<code>execute(ddl)</code>执行任何SQL，常用于执行DDL、DCL</p>
<p>-<code>executeUpdate(dml)</code>执行DML语句，如：<code>insert</code>，<code>update</code>，<code>delete</code></p>
<p>-<code>executeQuery(dql)</code>执行DQL语句，如：<code>select</code></p>
</li>
<li><p>处理结果</p>
<p>-<code>execute(ddl)</code>如果没有异常则成功 boolean</p>
<p>-<code>executeUpdate(dml)</code>返回数字，表示更新“行”数量，抛出异常则失败  int</p>
<p>-<code>executeQuery(dql)</code>返回<code>ResultSet</code>（结果）对象，代表2维查询结果， <code>ResultSet</code>使用<code>for</code>遍历处理，如果查询失败抛出异常</p>
</li>
<li><p>释放连接</p>
<p>-<code>conn.close();</code></p>
</li>
</ol>
<p>注意写代码之前，要导入数据库驱动包，连接不同厂商的数据库要用不同的驱动包</p>
<p><img alt="JDBC" data-src="//orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/JDBC.png" class="lazyload"></p>
<p>示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mysql.jdbc.ResultSetMetaData;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> dgm</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span> "原生jdbc"</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020年4月13日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// JDBC 驱动名及数据库 URL</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String JDBC_DRIVER = <span class="string">"com.mysql.jdbc.Driver"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DB_URL = <span class="string">"jdbc:mysql://192.168.8.200:3306/bdrackdemo?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true"</span>;</span><br><span class="line">    <span class="comment">// 数据库的用户名与密码，需要根据自己的设置</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String USER = <span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String PASS = <span class="string">"cstorfs"</span>;</span><br><span class="line">    <span class="keyword">static</span> Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取数据库配置文件</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readDBSetting</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">// 读取属性文件mysql.properties</span></span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            in = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(path));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 加载属性列表</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            prop.load(in);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; </span><br><span class="line">        Iterator&lt;String&gt; it = prop.stringPropertyNames().iterator();</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            String key = it.next();</span><br><span class="line">            System.out.println(key + <span class="string">"="</span> + prop.getProperty(key));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 读取mysql 配置信息</span></span><br><span class="line">        readDBSetting(<span class="string">"conf/mysql.properties"</span>);</span><br><span class="line"></span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        Statement stmt = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 注册 JDBC 驱动</span></span><br><span class="line">            Class.forName(prop.getProperty(<span class="string">"dbDriver"</span>)).newInstance();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 打开链接</span></span><br><span class="line">            System.out.println(<span class="string">"连接数据库..."</span>);</span><br><span class="line">            conn = DriverManager</span><br><span class="line">                    .getConnection(</span><br><span class="line">                            <span class="string">"jdbc:mysql://"</span></span><br><span class="line">                                    + prop.getProperty(<span class="string">"mysqlhost"</span>)</span><br><span class="line">                                    + <span class="string">":"</span></span><br><span class="line">                                    + prop.getProperty(<span class="string">"mysqlport"</span>)</span><br><span class="line">                                    + <span class="string">"/"</span></span><br><span class="line">                                    + prop.getProperty(<span class="string">"dbname"</span>)</span><br><span class="line">                                    + <span class="string">"?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true"</span>,</span><br><span class="line">                            prop.getProperty(<span class="string">"mysqluser"</span>),</span><br><span class="line">                            prop.getProperty(<span class="string">"mysqlpwd"</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 执行查询</span></span><br><span class="line">            System.out.println(<span class="string">" 实例化Statement对象..."</span>);</span><br><span class="line">            stmt = conn.createStatement();</span><br><span class="line">            String sql = <span class="string">"SELECT id, username, number FROM student"</span>;</span><br><span class="line">            rs = stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 展开结果集数据库</span></span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="comment">// 输出数据</span></span><br><span class="line">                System.out.print(<span class="string">"用户id: "</span> + rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">                System.out.print(<span class="string">", 用户名: "</span> + rs.getString(<span class="string">"username"</span>));</span><br><span class="line">                System.out.print(<span class="string">", 学号: "</span> + rs.getString(<span class="string">"number"</span>));</span><br><span class="line">                System.out.print(<span class="string">"\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException se) &#123;</span><br><span class="line">            se.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭资源</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (rs != <span class="keyword">null</span>)</span><br><span class="line">                    rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException se3) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (stmt != <span class="keyword">null</span>)</span><br><span class="line">                    stmt.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException se2) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (conn != <span class="keyword">null</span>)</span><br><span class="line">                    conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException se) &#123;</span><br><span class="line">                se.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>早期开发将上述代码自己封装成JDBC工具，传入SQL语句。这种模式在规模不大的情况下，使用起来挺好</p>
<h2 id="开发技巧"><a href="#开发技巧" class="headerlink" title="开发技巧"></a>开发技巧</h2><ol>
<li>使用PrearedStatement，可以通过预编译的方式避免在拼接SQL时造成SQL注入。</li>
<li>使用ConnectionPool</li>
<li>禁用自动提交<br>这个最佳实践在我们使用JDBC的批量提交的时候显得非常有用，将自动提交禁用后，你可以将一组数据库操作放在一个事务中，而自动提交模式每次执行SQL语句都将执行自己的事务，并且在执行结束提交。</li>
<li>使用Batch Update：批量更新/删除，比单个更新/删除，能显著减少数据传输的往返次数，提高性能。</li>
<li>使用列名获取ResultSet中的数据，从而避免invalidColumIndexError<br>JDBC中的查询结果封装在ResultSet中，我们可以通过列名和列序号两种方式获取查询的数据，当我们传入的列序号不正确的时候，就会抛出invalidColumIndexException，例如你传入了0，就会出错，因为ResultSet中的列序号是从1开始的。另外，如果你更改了数据表中列的顺序，你也不必更改JDBC代码，保持了程序的健壮性。有一些Java程序员可能会说通过序号访问列要比列名访问快一些，确实是这样，但是为了程序的健壮性、可读性，我还是更推荐你使用列名来访问。</li>
<li>使用变量绑定而不是字符串拼接<br>使用PreparedStatment可以防止注入，而使用<code>?</code>或者其他占位符也会提升性能，因为这样数据库就可以使用不同的参数执行相同的查询，提示性能，也防止SQL注入。</li>
<li>关闭Connection 等资源，确保资源被释放；</li>
<li>选择合适的JDBC驱动，参考前文，选择第四种；</li>
<li>尽量使用标准的SQL语句，从而在某种程度上避免数据库对SQL支持的差异<br>不同的数据库厂商的数据库产品支持的SQL的语法会有一定的出入，为了方便移植，推荐使用标准的ANSI SQL标准写SQL语句。</li>
<li>使用正确的getXXX()方法<br>当从ResultSet中读取数据的时候，虽然JDBC允许你使用getString()和getObject()方法获取任何数据类型，推荐使用正确的getter方法，这样可以避免数据类型转换。</li>
</ol>
<h2 id="连接步骤"><a href="#连接步骤" class="headerlink" title="连接步骤"></a>连接步骤</h2><p>JAVA操作关系型数据库<img alt="JDBC连接" data-src="//orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/JDBC连接.png" class="lazyload"></p>
<p>上图大致画出以访问MySQL为例，执行一条 SQL 命令的流程：</p>
<ol>
<li>TCP建立连接的三次握手；</li>
<li>MySQL认证的三次握手；</li>
<li>真正的SQL执行；</li>
<li>MySQL的关闭；</li>
<li>TCP的四次握手关闭；</li>
</ol>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><p>由上图可知，为了执行一条SQL，有大量的网络交互，性价比低<br><strong>优点</strong>：实现简单<br><strong>缺点</strong>：</p>
<ol>
<li>网络IO较多</li>
<li>数据库的负载较高</li>
<li>响应时间较长及QPS较低</li>
<li>应用频繁的创建连接和关闭连接，导致临时对象较多，GC频繁</li>
<li>在关闭连接后，会出现大量TIME_WAIT 的TCP状态(在2个MSL之后关闭)。</li>
<li>大项目中使用很复杂</li>
<li>没有封装</li>
<li>难以实现 MVC 的概念</li>
<li>很大的编程成本</li>
</ol>
<h1 id="池化数据库连接的JDBC"><a href="#池化数据库连接的JDBC" class="headerlink" title="池化数据库连接的JDBC"></a>池化数据库连接的JDBC</h1><p>原生JDBC的瓶颈在于数据库连接，通过池化技术可解决</p>
<h2 id="池化连接"><a href="#池化连接" class="headerlink" title="池化连接"></a>池化连接</h2><blockquote>
<p>池化技术简单点说就是预先连接好一定数量的连接，等需要时随意从中选择一个进行操作。比如线程池。</p>
</blockquote>
<p>连接池负责：连接建立、连接释放、连接管理、连接分配。</p>
<p><strong>数据库连接池运行机制</strong><br>系统初始化时创建连接池，程序操作数据库时从连接池中获取空闲连接，程序使用完毕将连接归还到连接池中，系统退出时，断开所有数据库连接并释放内存资源。</p>
<p><strong>使用池化连接的好处</strong></p>
<ol>
<li>性能。连接到数据库既昂贵又缓慢。池化连接可以保持与数据库的物理连接，并在需要数据库访问的各个组件之间共享。这样一来，连接成本便一次性支付，并在所有消耗组件中摊销。</li>
<li>诊断。如果您有一个子系统负责连接到数据库，则诊断和分析数据库连接使用情况将变得更加容易。</li>
<li>可维护性。同样，如果您有一个子系统负责分发数据库连接，则与每个组件都连接到数据库本身相比，代码将更易于维护。</li>
</ol>
<p><strong>为什么池化连接能带来性能上的提高</strong></p>
<p>因为无论何时请求一个连接，池数据源会从可用的连接池获取新连接。仅当没有可用的连接而且未达到最大的连接数时连接池将创建新的连接。<code>close()</code>方法把连接返回到连接池而不是真正地关闭它</p>
<p>重用数据库连接最明显的原因：</p>
<ul>
<li>减少应用程序和数据库管理系统创建/销毁TCP连接的OS I/O开销</li>
<li>减少JVM对象垃圾</li>
<li>缓冲安全：连接池是即将到来的连接请求的有界缓冲区。如果出现瞬间流量尖峰，连接池会平缓这一变化，而不是使所有可用数据库资源趋于饱和。</li>
<li>等待步骤和超时机制，可有效防止数据库服务器过载。如果一个应用消耗太多数据库流量，为防止它将数据库服务器压垮，连接池将减少它对数据库的使用。</li>
</ul>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ul>
<li>C3P0：开源JDBC连接池，实现数据源和JNDI绑定，包括实现jdbc3和jdbc2扩展规范说明的Connection 和Statement 池的DataSources 对象。单线程，性能较差，适用于小型系统，代码600KB左右。</li>
<li>BoneCP：开源的快速的 JDBC 连接池。只有四十几K（运行时需要log4j和Google Collections的支持）。另外个人觉得 BoneCP 有个缺点是，JDBC驱动的加载是在连接池之外的，这样在一些应用服务器的配置上就不够灵活。官方说法BoneCP是一个高效、免费、开源的Java数据库连接池实现库。设计初衷就是为了提高数据库连接池性能，完美集成到一些持久化产品如Hibernate和DataNucleus中。特色：高度可扩展，快速；连接状态切换的回调机制；允许直接访问连接；自动化重置能力；JMX支持；懒加载能力；支持XML和属性文件配置方式；较好的Java代码组织。</li>
<li>DBCP：Database Connection Pool，一个依赖Jakarta commons-pool对象池机制的数据库连接池，单独使用dbcp需要3个包：<code>common-dbcp.jar,common-pool.jar,common-collections.jar</code>，预先将数据库连接放在内存中，应用程序需要建立数据库连接时直接到连接池中申请一个就行，用完再放回。单线程，并发量低，性能不好，适用于小型系统。</li>
<li>Tomcat Jdbc Pool：Tomcat在7.0以前都是使用common-dbcp做为连接池组件，但是dbcp是单线程，为保证线程安全会锁整个连接池，性能较差，dbcp有超过60个类，也相对复杂。Tomcat从7.0开始引入新增连接池模块叫做Tomcat jdbc pool，基于Tomcat JULI，使用Tomcat日志框架，完全兼容dbcp，通过异步方式获取连接，支持高并发应用环境，超级简单核心文件只有8个，支持JMX，支持XA Connection。</li>
<li>Druid：阿里出品，淘宝和支付宝专用数据库连接池，但它不仅仅是一个数据库连接池，它还包含一个ProxyDriver，一系列内置的JDBC组件库，一个SQL Parser。支持所有JDBC兼容的数据库。Druid针对Oracle和MySQL特别优化，比如Oracle的PS Cache内存占用优化，MySQL的ping检测优化。</li>
<li>HikariCP：新一代数据库连接池，性能相当优异，spring boot 2 默认使用的 dbcp 从之前的 tomcat-pool 换成HikariCP 。</li>
</ul>
<h2 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h2><ol>
<li>导入连接池jar</li>
<li>创建连接池对象</li>
<li>设置数据库必须的连接参数</li>
<li>设置可选的连接池管理策略参数</li>
<li>从连接池中获得活动的数据库连接</li>
<li>使用连接范围数据量</li>
<li>使用以后关闭数据库连接，这个关闭不再是真的关闭连接，而是将使用过的连接归还给连接池</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> initSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BasicDataSource ds; <span class="comment">//连接池就一个</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        ds = <span class="keyword">new</span> BasicDataSource();</span><br><span class="line">        Properties cfg = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">//初始化静态属性</span></span><br><span class="line">        <span class="comment">//利用properties 读取配置文件</span></span><br><span class="line">        <span class="comment">//从配置文件中查找相应参数</span></span><br><span class="line">        <span class="keyword">try</span> &#123;            <span class="comment">//load天生有异常</span></span><br><span class="line">            InputStream in = DBUtils.class.getClassLoader()</span><br><span class="line">                    .getResourceAsStream(<span class="string">"db.properties"</span>);</span><br><span class="line">            cfg.load(in);</span><br><span class="line"> </span><br><span class="line">            driver = cfg.getProperty(<span class="string">"jdbc.driver"</span>);</span><br><span class="line">            url = cfg.getProperty(<span class="string">"jdbc.url"</span>);</span><br><span class="line">            username = cfg.getProperty(<span class="string">"jdbc.username"</span>);</span><br><span class="line">            password = cfg.getProperty(<span class="string">"jdbc.pasaword"</span>);</span><br><span class="line">            initSize = Integer.parseInt(cfg.getProperty(<span class="string">"initSize"</span>));</span><br><span class="line">            in.close();</span><br><span class="line">            <span class="comment">//初始化连接池</span></span><br><span class="line">            ds.setDriverClassName(driver);</span><br><span class="line">            ds.setUrl(url);</span><br><span class="line">            ds.setUsername(username);</span><br><span class="line">            ds.setPassword(password);</span><br><span class="line">            <span class="comment">//设置连接池的管理策略参数</span></span><br><span class="line">            ds.setInitialSize(initSize);</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//getConnection()从连接池获取重用的连接，如果连接池满了，则等待</span></span><br><span class="line">            <span class="comment">//如果连接归还，则获取重用的连接; 连接池的线程阻塞方法</span></span><br><span class="line">            Connection conn = ds.getConnection();</span><br><span class="line">            <span class="keyword">return</span> conn;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//将用过的连接归还到连接池</span></span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">(Connection conn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//将用过的连接归还到连接池</span></span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">                conn.rollback();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h1><p>JDBC的另一方面的缺点是不易于大型项目的开发，Hibernate的出现就是为了弥补这一缺陷</p>
<p>Hibernate是一个持久化框架和ORM框架，持久化和ORM是两个有区别的概念，持久化注重对象的存储方法是否随着程序的退出而消亡，ORM关注的是如何在数据库表和内存对象之间建立关联。</p>
<p>Hibernate使用POJO来表示Model，使用XML配置文件来配置对象和表之间的关系，它提供了一系列API来通过对对象的操作而改变数据库中的过程。</p>
<p>Hibernate更强调如何对单条记录进行操作，对于更复杂的操作，它提供了一种新的面向对象的查询语言：HQL。</p>
<blockquote>
<p>当我们工作在一个面向对象的系统中时，存在一个对象模型和关系数据库不匹配的问题。RDBMSs 用表格的形式存储数据，然而像 Java 或者 C# 这样的面向对象的语言它表示一个对象关联图。这时就需要ORM</p>
<p>ORM 表示 Object-Relational Mapping (ORM)，是一个方便在关系数据库和类似于 Java， C# 等面向对象的编程语言中转换数据的技术。一个 ORM 系统相比于普通的 JDBC 有以下的优点。</p>
<ul>
<li>使用业务代码访问对象而不是数据库中的表</li>
<li>从面向对象逻辑中隐藏 SQL 查询的细节</li>
<li>基于 JDBC 的 ‘under the hood’</li>
<li>没有必要去处理数据库实现</li>
<li>实体是基于业务的概念而不是数据库的结构</li>
<li>事务管理和键的自动生成</li>
<li>应用程序的快速开发</li>
</ul>
</blockquote>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><div class="table-container">
<table>
<thead>
<tr>
<th><img alt="架构" data-src="//orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/hibernate_architecture.jpg" class="lazyload"></th>
<th><img alt="高层次架构" data-src="//orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/hibernate_high_level.jpg" class="lazyload"></th>
</tr>
</thead>
<tbody>
<tr>
<td>详细的 Hibernate 应用程序体系结构</td>
<td>非常高水平的 Hibernate 应用程序架构</td>
</tr>
</tbody>
</table>
</div>
<p>Hibernate 架构是分层的，作为数据访问层，你不必知道底层 API 。Hibernate 利用数据库以及配置数据来为应用程序提供持续性服务（以及持续性对象）</p>
<p>Hibernate 使用不同的现存 Java API，比如 JDBC，Java 事务 API（JTA），以及 Java 命名和目录界面（JNDI）。JDBC 提供了一个基本的抽象级别的通用关系数据库的功能， Hibernate 支持几乎所有带有 JDBC 驱动的数据库。JNDI 和 JTA 允许 Hibernate 与 J2EE 应用程序服务器相集成。</p>
<h2 id="开发步骤-2"><a href="#开发步骤-2" class="headerlink" title="开发步骤"></a>开发步骤</h2><h3 id="准备Hibernate环境"><a href="#准备Hibernate环境" class="headerlink" title="准备Hibernate环境"></a>准备Hibernate环境</h3><p>导入Hibernate必须的jar包：导入hibernate-release-5.0.2.Final\lib\required下的jar包</p>
<p>加入数据库驱动的jar包</p>
<h3 id="创建核心配置文件"><a href="#创建核心配置文件" class="headerlink" title="创建核心配置文件"></a>创建核心配置文件</h3><p>Hibernate 需要事先知道在哪里找到映射信息，这些映射信息定义了 Java 类怎样关联到数据库表。Hibernate 也需要一套相关数据库和其它相关参数的配置设置。</p>
<p>所有这些信息通常是作为一个标准的 Java 属性文件提供的，名叫 <code>hibernate.properties</code>。又或者是作为 XML 文件提供的，名叫 <code>hibernate.cfg.xml</code></p>
<p>例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- 配置连接数据库的基本信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.password"</span>&gt;</span>ds756953242<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.url"</span>&gt;</span>jdbc:mysql:///hibernate<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 配置 hibernate 的基本信息 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- hibernate 所使用的数据库方言 </span></span><br><span class="line"><span class="comment">        &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLMyISAMDialect&lt;/property&gt;        </span></span><br><span class="line"><span class="comment">        &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span>&gt;</span>org.hibernate.dialect.MySQL5InnoDBDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span>        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 执行操作时是否在控制台打印 SQL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- 是否对 SQL 进行格式化 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- 指定自动生成数据表的策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 指定关联的 .hbm.xml 文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"helloWorld/customer.hbm.xml"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建持久化Java类"><a href="#创建持久化Java类" class="headerlink" title="创建持久化Java类"></a>创建持久化Java类</h3><p>在 Hibernate 中，其对象或实例将会被存储在数据库表单中的 Java 类被称为持久化类。若该类遵循一些简单的规则或者被大家所熟知的 Plain Old Java Object (POJO) 编程模型。</p>
<p><strong>持久化类的要求</strong></p>
<ol>
<li>提供一个无参的构造器：使Hibernate可以使用<code>Constructor.newInstance()</code> 来实例化持久化类</li>
<li>为了使对象能够在 Hibernate 和数据库中容易识别，所有类都需要包含一个 ID。此属性映射到数据库表的主键列。</li>
<li>为类的持久化类字段声明访问方法(<code>get/set</code>): Hibernate对JavaBeans 风格的属性实行持久化。</li>
<li>所有将被持久化的属性都应该声明为 private</li>
<li>使用非 final 类: 在运行时生成代理是 Hibernate 的一个重要的功能. 如果持久化类没有实现任何接口, Hibnernate 使用 CGLIB 生成代理. 如果使用的是 final 类, 则无法生成 CGLIB 代理.</li>
<li>重写 eqauls 和 hashCode 方法: 如果需要把持久化类的实例放到 Set 中(当需要进行关联映射时), 则应该重写这两个方法</li>
<li>Hibernate 不要求持久化类继承任何父类或实现接口，这可以保证代码不被污染。这就是Hibernate被称为低侵入式设计的原因</li>
</ol>
<p>例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">   <span class="keyword">private</span> String firstName; </span><br><span class="line">   <span class="keyword">private</span> String lastName;   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> salary;  </span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      firstName=<span class="keyword">null</span>;</span><br><span class="line">      lastName=<span class="keyword">null</span>;</span><br><span class="line">      salary =<span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String fname, String lname, <span class="keyword">int</span> salary)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.firstName = fname;</span><br><span class="line">      <span class="keyword">this</span>.lastName = lname;</span><br><span class="line">      <span class="keyword">this</span>.salary = salary;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">( <span class="keyword">int</span> id )</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> firstName;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">( String first_name )</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.firstName = first_name;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> lastName;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">( String last_name )</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.lastName = last_name;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> salary;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">( <span class="keyword">int</span> salary )</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.salary = salary;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建对象-关系映射文件"><a href="#创建对象-关系映射文件" class="headerlink" title="创建对象-关系映射文件"></a>创建对象-关系映射文件</h3><p>Hibernate 采用 XML 格式的文件来指定对象和关系数据之间的映射. 在运行时 Hibernate 将根据这个映射文件来生成各种 SQL 语句。映射文件的扩展名为 <code>.hbm.xml</code>。</p>
<p>有很多工具可以用来给先进的 Hibernate 用户生成映射文件。这样的工具包括 <strong>XDoclet</strong>, <strong>Middlegen</strong> 和 <strong>AndroMDA</strong></p>
<p>下面是一个Mapping映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta"> "-//Hibernate/Hibernate Mapping DTD//EN"</span></span><br><span class="line"><span class="meta"> "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Employee"</span> <span class="attr">table</span>=<span class="string">"EMPLOYEE"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">attribute</span>=<span class="string">"class-description"</span>&gt;</span></span><br><span class="line">         This class contains the employee detail. </span><br><span class="line">      <span class="tag">&lt;/<span class="name">meta</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"firstName"</span> <span class="attr">column</span>=<span class="string">"first_name"</span> <span class="attr">type</span>=<span class="string">"string"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">column</span>=<span class="string">"last_name"</span> <span class="attr">type</span>=<span class="string">"string"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"salary"</span> <span class="attr">column</span>=<span class="string">"salary"</span> <span class="attr">type</span>=<span class="string">"int"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;class&gt;</code>标签定义从一个 Java 类到数据库表的特定映射。Java 的类名使用 <strong>name</strong> 来表示，数据库表明用 <strong>table</strong> 来表示。</p>
<p><code>&lt;meta&gt;</code> 标签是一个可选元素，可以被用来修饰类。</p>
<p><code>&lt;id&gt;</code> 标签将类中独一无二的 ID 属性与数据库表中的主键关联起来。id 元素中的 <strong>name</strong> 对应类的属性，<strong>column</strong> 对应数据库表的列。<strong>type</strong> 保存 Hibernate 映射的类型，这个类型会将从 Java 转换成 SQL 数据类型。</p>
<p> id 元素中的 <code>&lt;generator&gt;</code> 标签用来自动生成主键值。设置 generator 标签中的 <strong>class</strong> 可以设置 <strong>native</strong> 使 Hibernate 可以使用 <strong>identity</strong>, <strong>sequence</strong> 或 <strong>hilo</strong> 算法根据底层数据库的情况来创建主键。</p>
<p><code>&lt;property&gt;</code> 标签用来将 Java 类的属性与数据库表的列匹配。标签中 <strong>name</strong> 引用的是类的属性，<strong>column</strong> 引用的是数据库表的列。<strong>type</strong> 保存 Hibernate <a href="https://www.w3cschool.cn/hibernate/fzum1iem.html" target="_blank" rel="noopener">映射的类型</a>，这个类型会将从 Java 转换成 SQL 数据类型。</p>
<h3 id="通过-Hibernate-API-编写访问数据库"><a href="#通过-Hibernate-API-编写访问数据库" class="headerlink" title="通过 Hibernate API 编写访问数据库"></a>通过 Hibernate API 编写访问数据库</h3><h4 id="创建会话Session"><a href="#创建会话Session" class="headerlink" title="创建会话Session"></a>创建会话Session</h4><p>Session 用于获取与数据库的物理连接。 Session 对象是轻量级的，并且设计为在每次需要与数据库进行交互时被实例化。持久态对象被保存，并通过 Session 对象检索找回。</p>
<p>该 Session 对象不应该长时间保持开放状态，因为它们通常不能保证线程安全，而应该根据需求被创建和销毁。Session 的主要功能是为映射实体类的实例提供创建，读取和删除操作。</p>
<h4 id="创建事务"><a href="#创建事务" class="headerlink" title="创建事务"></a>创建事务</h4><p>一个典型的事务应该使用以下语法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Session session = factory.openSession();</span><br><span class="line">Transaction tx = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   tx = session.beginTransaction();</span><br><span class="line">   <span class="comment">// do some work</span></span><br><span class="line">   ...</span><br><span class="line">   tx.commit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">   <span class="keyword">if</span> (tx!=<span class="keyword">null</span>) tx.rollback();</span><br><span class="line">   e.printStackTrace(); </span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">   session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果 Session 引发异常，则事务必须被回滚，该 session 必须被丢弃。</p>
<h4 id="Session-接口方法"><a href="#Session-接口方法" class="headerlink" title="Session 接口方法"></a>Session 接口方法</h4><div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th style="text-align:left">Session 方法及说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:left"><strong>Transaction beginTransaction()</strong> 开始工作单位，并返回关联事务对象。</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left"><strong>void cancelQuery()</strong> 取消当前的查询执行。</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:left"><strong>void clear()</strong> 完全清除该会话。</td>
</tr>
<tr>
<td>4</td>
<td style="text-align:left"><strong>Connection close()</strong> 通过释放和清理 JDBC 连接以结束该会话。</td>
</tr>
<tr>
<td>5</td>
<td style="text-align:left"><strong>Criteria createCriteria(Class persistentClass)</strong> 为给定的实体类或实体类的超类创建一个新的 Criteria 实例。</td>
</tr>
<tr>
<td>6</td>
<td style="text-align:left"><strong>Criteria createCriteria(String entityName)</strong> 为给定的实体名称创建一个新的 Criteria 实例。</td>
</tr>
<tr>
<td>7</td>
<td style="text-align:left"><strong>Serializable getIdentifier(Object object)</strong> 返回与给定实体相关联的会话的标识符值。</td>
</tr>
<tr>
<td>8</td>
<td style="text-align:left"><strong>Query createFilter(Object collection, String queryString)</strong> 为给定的集合和过滤字符创建查询的新实例。</td>
</tr>
<tr>
<td>9</td>
<td style="text-align:left"><strong>Query createQuery(String queryString)</strong> 为给定的 HQL 查询字符创建查询的新实例。</td>
</tr>
<tr>
<td>10</td>
<td style="text-align:left"><strong>SQLQuery createSQLQuery(String queryString)</strong> 为给定的 SQL 查询字符串创建 SQLQuery 的新实例。</td>
</tr>
<tr>
<td>11</td>
<td style="text-align:left"><strong>void delete(Object object)</strong> 从数据存储中删除持久化实例。</td>
</tr>
<tr>
<td>12</td>
<td style="text-align:left"><strong>void delete(String entityName, Object object)</strong> 从数据存储中删除持久化实例。</td>
</tr>
<tr>
<td>13</td>
<td style="text-align:left"><strong>Session get(String entityName, Serializable id)</strong> 返回给定命名的且带有给定标识符或 null 的持久化实例（若无该种持久化实例）。</td>
</tr>
<tr>
<td>14</td>
<td style="text-align:left"><strong>SessionFactory getSessionFactory()</strong> 获取创建该会话的 session 工厂。</td>
</tr>
<tr>
<td>15</td>
<td style="text-align:left"><strong>void refresh(Object object)</strong> 从基本数据库中重新读取给定实例的状态。</td>
</tr>
<tr>
<td>16</td>
<td style="text-align:left"><strong>Transaction getTransaction()</strong> 获取与该 session 关联的事务实例。</td>
</tr>
<tr>
<td>17</td>
<td style="text-align:left"><strong>boolean isConnected()</strong> 检查当前 session 是否连接。</td>
</tr>
<tr>
<td>18</td>
<td style="text-align:left"><strong>boolean isDirty()</strong> 该 session 中是否包含必须与数据库同步的变化？</td>
</tr>
<tr>
<td>19</td>
<td style="text-align:left"><strong>boolean isOpen()</strong> 检查该 session 是否仍处于开启状态。</td>
</tr>
<tr>
<td>20</td>
<td style="text-align:left"><strong>Serializable save(Object object)</strong> 先分配一个生成的标识，以保持给定的瞬时状态实例。</td>
</tr>
<tr>
<td>21</td>
<td style="text-align:left"><strong>void saveOrUpdate(Object object)</strong> 保存（对象）或更新（对象）给定的实例。</td>
</tr>
<tr>
<td>22</td>
<td style="text-align:left"><strong>void update(Object object)</strong> 更新带有标识符且是给定的处于脱管状态的实例的持久化实例。</td>
</tr>
<tr>
<td>23</td>
<td style="text-align:left"><strong>void update(String entityName, Object object)</strong> 更新带有标识符且是给定的处于脱管状态的实例的持久化实例。</td>
</tr>
</tbody>
</table>
</div>
<h4 id="HQL语法"><a href="#HQL语法" class="headerlink" title="HQL语法"></a>HQL语法</h4><p>Hibernate 查询语言（HQL）是一种面向对象的查询语言，类似于 SQL，但不是去对表和列进行操作，而是面向对象和它们的属性。 HQL 查询被 Hibernate 翻译为传统的 SQL 查询从而对数据库进行操作。</p>
<p>尽管你能直接使用本地 SQL 语句，但我还是建议你尽可能的使用 HQL 语句，以避免数据库关于可移植性的麻烦，并且体现了 Hibernate 的 SQL 生成和缓存策略。</p>
<p>在 HQL 中一些关键字比如 SELECT ，FROM 和 WHERE 等，是不区分大小写的，但是一些属性比如表名和列名是区分大小写的。</p>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List; </span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator; </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.HibernateException; </span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session; </span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManageEmployee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> SessionFactory factory; </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         factory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">      &#125;<span class="keyword">catch</span> (Throwable ex) &#123; </span><br><span class="line">         System.err.println(<span class="string">"Failed to create sessionFactory object."</span> + ex);</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ExceptionInInitializerError(ex); </span><br><span class="line">      &#125;</span><br><span class="line">      ManageEmployee ME = <span class="keyword">new</span> ManageEmployee();</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Add few employee records in database */</span></span><br><span class="line">      Integer empID1 = ME.addEmployee(<span class="string">"Zara"</span>, <span class="string">"Ali"</span>, <span class="number">1000</span>);</span><br><span class="line">      Integer empID2 = ME.addEmployee(<span class="string">"Daisy"</span>, <span class="string">"Das"</span>, <span class="number">5000</span>);</span><br><span class="line">      Integer empID3 = ME.addEmployee(<span class="string">"John"</span>, <span class="string">"Paul"</span>, <span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* List down all the employees */</span></span><br><span class="line">      ME.listEmployees();</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Update employee's records */</span></span><br><span class="line">      ME.updateEmployee(empID1, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Delete an employee from the database */</span></span><br><span class="line">      ME.deleteEmployee(empID2);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* List down new list of the employees */</span></span><br><span class="line">      ME.listEmployees();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* Method to CREATE an employee in the database */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Integer <span class="title">addEmployee</span><span class="params">(String fname, String lname, <span class="keyword">int</span> salary)</span></span>&#123;</span><br><span class="line">      Session session = factory.openSession();</span><br><span class="line">      Transaction tx = <span class="keyword">null</span>;</span><br><span class="line">      Integer employeeID = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         tx = session.beginTransaction();</span><br><span class="line">         Employee employee = <span class="keyword">new</span> Employee(fname, lname, salary);</span><br><span class="line">         employeeID = (Integer) session.save(employee); </span><br><span class="line">         tx.commit();</span><br><span class="line">      &#125;<span class="keyword">catch</span> (HibernateException e) &#123;</span><br><span class="line">         <span class="keyword">if</span> (tx!=<span class="keyword">null</span>) tx.rollback();</span><br><span class="line">         e.printStackTrace(); </span><br><span class="line">      &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">         session.close(); </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> employeeID;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* Method to  READ all the employees */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listEmployees</span><span class="params">( )</span></span>&#123;</span><br><span class="line">      Session session = factory.openSession();</span><br><span class="line">      Transaction tx = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         tx = session.beginTransaction();</span><br><span class="line">         List employees = session.createQuery(<span class="string">"FROM Employee"</span>).list(); </span><br><span class="line">         <span class="keyword">for</span> (Iterator iterator = </span><br><span class="line">                           employees.iterator(); iterator.hasNext();)&#123;</span><br><span class="line">            Employee employee = (Employee) iterator.next(); </span><br><span class="line">            System.out.print(<span class="string">"First Name: "</span> + employee.getFirstName()); </span><br><span class="line">            System.out.print(<span class="string">"  Last Name: "</span> + employee.getLastName()); </span><br><span class="line">            System.out.println(<span class="string">"  Salary: "</span> + employee.getSalary()); </span><br><span class="line">         &#125;</span><br><span class="line">         tx.commit();</span><br><span class="line">      &#125;<span class="keyword">catch</span> (HibernateException e) &#123;</span><br><span class="line">         <span class="keyword">if</span> (tx!=<span class="keyword">null</span>) tx.rollback();</span><br><span class="line">         e.printStackTrace(); </span><br><span class="line">      &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">         session.close(); </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* Method to UPDATE salary for an employee */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateEmployee</span><span class="params">(Integer EmployeeID, <span class="keyword">int</span> salary )</span></span>&#123;</span><br><span class="line">      Session session = factory.openSession();</span><br><span class="line">      Transaction tx = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         tx = session.beginTransaction();</span><br><span class="line">         Employee employee = </span><br><span class="line">                    (Employee)session.get(Employee.class, EmployeeID); </span><br><span class="line">         employee.setSalary( salary );</span><br><span class="line">         session.update(employee); </span><br><span class="line">         tx.commit();</span><br><span class="line">      &#125;<span class="keyword">catch</span> (HibernateException e) &#123;</span><br><span class="line">         <span class="keyword">if</span> (tx!=<span class="keyword">null</span>) tx.rollback();</span><br><span class="line">         e.printStackTrace(); </span><br><span class="line">      &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">         session.close(); </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/* Method to DELETE an employee from the records */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteEmployee</span><span class="params">(Integer EmployeeID)</span></span>&#123;</span><br><span class="line">      Session session = factory.openSession();</span><br><span class="line">      Transaction tx = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         tx = session.beginTransaction();</span><br><span class="line">         Employee employee = </span><br><span class="line">                   (Employee)session.get(Employee.class, EmployeeID); </span><br><span class="line">         session.delete(employee); </span><br><span class="line">         tx.commit();</span><br><span class="line">      &#125;<span class="keyword">catch</span> (HibernateException e) &#123;</span><br><span class="line">         <span class="keyword">if</span> (tx!=<span class="keyword">null</span>) tx.rollback();</span><br><span class="line">         e.printStackTrace(); </span><br><span class="line">      &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">         session.close(); </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><p>MyBatis和Hibernate一样是一个持久化框架和ORM框架。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs映射成数据库中的记录</p>
<h2 id="架构-1"><a href="#架构-1" class="headerlink" title="架构"></a>架构</h2><ol>
<li>API接口层：提供给外部使用的接口API，开发人员通过这些本地API来操纵数据库。接口层一接收到调用请求就会调用数据处理层来完成具体的数据处理。</li>
<li>数据处理层：负责具体的SQL查找、SQL解析、SQL执行和执行结果映射处理等。它主要的目的是根据调用的请求完成一次数据库操作。</li>
<li>基础支撑层：负责最基础的功能支撑，包括连接管理、事务管理、配置加载和缓存处理，这些都是共用的东西，将他们抽取出来作为最基础的组件。为上层的数据处理层提供最基础的支撑。</li>
</ol>
<h2 id="开发步骤-3"><a href="#开发步骤-3" class="headerlink" title="开发步骤"></a>开发步骤</h2><h3 id="准备MyBatis环境"><a href="#准备MyBatis环境" class="headerlink" title="准备MyBatis环境"></a>准备MyBatis环境</h3><p>导入Hibernate必须的jar包：导入mybatis-3.2.2.jar包</p>
<p>加入数据库驱动的jar包mysql-connector-java-5.1.10-bin.jar </p>
<h3 id="创建核心配置文件-1"><a href="#创建核心配置文件-1" class="headerlink" title="创建核心配置文件"></a>创建核心配置文件</h3><p>Mybatis需要事先知道在哪里找到映射信息。Mybatis也需要一套相关数据库和其它相关参数的配置设置。</p>
<p>所有这些信息通常是作为一个标准的 Java 属性文件提供的。又或者是作为 XML 文件提供的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置开发环境，可以配置多个，在具体用时再做切换 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span>  <span class="comment">&lt;!-- 事务管理类型：JDBC、MANAGED --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span>    <span class="comment">&lt;!-- 数据源类型：POOLED、UNPOOLED、JNDI --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/test?characterEncoding=utf-8"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载映射文件 mapper --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 路径用 斜线（/） 分割，而不是用 点(.) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"yeepay/payplus/mapper/UserMapper.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建持久化Java类-1"><a href="#创建持久化Java类-1" class="headerlink" title="创建持久化Java类"></a>创建持久化Java类</h3><p>遵循POJO类要求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> yeepay.payplus;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by 维C果糖 on 2017/2/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建对象-关系映射、定义SQL语句"><a href="#创建对象-关系映射、定义SQL语句" class="headerlink" title="创建对象-关系映射、定义SQL语句"></a>创建对象-关系映射、定义SQL语句</h3><p>MyBatis采用 XML 格式的文件来指定对象和关系数据之间的映射. MyBatis3加入了注解形式</p>
<h4 id="XML形式"><a href="#XML形式" class="headerlink" title="XML形式"></a>XML形式</h4><p><strong>文件中的一些属性</strong></p>
<p>设置 <code>namespace</code> 命名空间，目的是为了区分映射文件中的方法</p>
<p>结果集 <code>resultMap</code> 是 MyBatis 最大的特色，对象的 ORM 就由其来转换</p>
<ul>
<li>在结果集中，包括主键 <code>id</code> 和 普通属性 <code>result</code>；</li>
<li>在结果集中，常用的两个属性分别为：<code>property</code>，表示实体的属性；<code>column</code>，表示 SQL 查询的结果集的列。</li>
</ul>
<p>在映射文件中，常用的标签有四个，分别为： <code>select</code>、<code>insert</code>、<code>update</code> 和 <code>delete</code></p>
<ul>
<li>每个标签中都有 id 属性，在同一个 mapper 文件中 id 不允许重复；</li>
<li>参数 <code>parameterMap</code> 已经被废弃，现在其存在的目的就是为了兼容前期的项目；</li>
<li>参数 <code>parameterType</code> 支持很多的类型，例如 <code>int</code>、<code>Integer</code>、<code>String</code>、<code>Double</code>、<code>List</code>、<code>Map</code> 或者实体对象等；</li>
<li>返回值 <code>resultType</code> 用于简单的类型；</li>
<li>返回值 <code>resultMap</code> 用于复杂的类型；</li>
<li>当参数和返回值是集合的时候，其声明的是集合中的元素类型；</li>
<li>SQL 语句不区分大小写，它默认使用 <code>PrepareStatement</code>，预编译，可以防止 SQL 注入。</li>
</ul>
<p>获取参数的方法为 #{ 字段名 }**</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"yeepay.payplus/mapper.UserMapper"</span>&gt;</span>   <span class="comment">&lt;!-- 命名空间，名字可以随意起，只要不冲突即可 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 对象映射，可以不写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"yeepay.payplus.Person"</span> <span class="attr">id</span>=<span class="string">"personRM"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- property="id"，表示实体对象的属性；column="ID"，表示结果集字段 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"ID"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"Name"</span> <span class="attr">column</span>=<span class="string">"NAME"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"age"</span> <span class="attr">column</span>=<span class="string">"AGE"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 查询功能，resultType 设置返回值类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"yeepay.payplus.Person"</span>&gt;</span>  <span class="comment">&lt;!-- 书写 SQL 语句 --&gt;</span></span><br><span class="line">        SELECT * FROM person</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通过 ID 查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultMap</span>=<span class="string">"personRM"</span>&gt;</span>  <span class="comment">&lt;!-- 书写 SQL 语句 --&gt;</span></span><br><span class="line">        SELECT * FROM person</span><br><span class="line">        WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 新增功能，在SQL语句中有参数，并以实体来封装参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">parameterType</span>=<span class="string">"yeepay.payplus.Person"</span>&gt;</span></span><br><span class="line">        INSERT INTO person (id,name,age) VALUES (#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改功能 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"yeepay.payplus.Person"</span>&gt;</span></span><br><span class="line">        UPDATE person set name=#&#123;name&#125;,age=#&#123;age&#125;</span><br><span class="line">        WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 删除功能 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteById"</span> <span class="attr">parameterType</span>=<span class="string">"integer"</span>&gt;</span></span><br><span class="line">        DELETE FROM person</span><br><span class="line">        WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="定义动态SQL"><a href="#定义动态SQL" class="headerlink" title="定义动态SQL"></a>定义动态SQL</h5><p>动态SQL支持根据不同条件拼接 SQL 语句，可用标签：</p>
<ul>
<li>if</li>
<li>choose (when, otherwise)</li>
<li>trim (where, set)</li>
<li>foreach</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 动态SQL，parameterType 设置参数类型，resultType 设置返回值类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">parameterType</span>=<span class="string">"yeepay.payplus.Person"</span> <span class="attr">resultType</span>=<span class="string">"Person"</span>&gt;</span>  </span><br><span class="line">        SELECT id,name,age FROM person</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name =! null"</span>&gt;</span></span><br><span class="line">                name = #&#123;name&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"age =! null"</span>&gt;</span></span><br><span class="line">                and age = #&#123;age&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- 批量删除，Map 类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteMap"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span>&gt;</span></span><br><span class="line">        DELETE FROM person WHERE id IN</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        AND  age = #&#123;age&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 批量删除，List 类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteList"</span> <span class="attr">parameterType</span>=<span class="string">"integer"</span>&gt;</span></span><br><span class="line">        DELETE FROM person WHERE id IN</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="1-N映射关系定义"><a href="#1-N映射关系定义" class="headerlink" title="1:N映射关系定义"></a>1:N映射关系定义</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置关联关系 1:N --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"yeepay.payplus.domain.Customer"</span> <span class="attr">id</span>=<span class="string">"customerOrdersRM"</span> <span class="attr">extends</span>=<span class="string">"customerRM"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置多的（N），property 属性就是实体中的 List 对象属性名称，ofType 属性就是集合元素的类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orders"</span> <span class="attr">ofType</span>=<span class="string">"yeepay.payplus.domain.Orders"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"ID"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sn"</span> <span class="attr">column</span>=<span class="string">"SN"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"remark"</span> <span class="attr">column</span>=<span class="string">"REMARK"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="注解形式"><a href="#注解形式" class="headerlink" title="注解形式"></a>注解形式</h4><p>因为最初设计时,MyBatis 是一个 XML 驱动的框架。配置信息是基于 XML 的,而且 映射语句也是定义在 XML 中的。而到了 MyBatis 3,有新的可用的选择了。MyBatis 3 构建 在基于全面而且强大的 Java 配置 API 之上。这个配置 API 是基于 XML 的 MyBatis 配置的 基础,也是新的基于注解配置的基础。注解提供了一种简单的方式来实现简单映射语句,而 不会引入大量的开销。</p>
<p>注意 不幸的是,Java 注解限制了它们的表现和灵活。尽管很多时间都花调查,设计和 实验上,最强大的 MyBatis 映射不能用注解来构建,那并不可笑。C#属性(做示例)就没 有这些限制,因此 MyBatis.NET 将会比 XML 有更丰富的选择。也就是说,基于 Java 注解 的配置离不开它的特性。</p>
<p><strong>注解有下面这些:</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>注解</th>
<th>目标</th>
<th>相对应的 XML</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@CacheNamespace</code></td>
<td><code>class</code></td>
<td></td>
</tr>
<tr>
<td><code>@CacheNamespaceRef</code></td>
<td><code>class</code></td>
<td></td>
</tr>
<tr>
<td><code>@ConstructorArgs</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@Arg</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@TypeDiscriminator</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@Case</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@Results</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@Result</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@One</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@Many</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@MapKey</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@Options</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@Insert</code>,<code>@Update</code>, <code>@Delete</code>, <code>@Select</code></td>
<td><code>Method</code></td>
<td><code>&lt;insert&gt;</code>,<code>&lt;update&gt;</code>,<code>&lt;delete&gt;</code>,<code>&lt;select&gt;</code></td>
</tr>
<tr>
<td><code>@InsertProvider,@UpdateProvider,@DeleteProvider,@SelectProvider</code></td>
<td><code>Method</code></td>
<td><code>&lt;insert&gt;</code>,<code>&lt;update&gt;</code>,<code>&lt;delete&gt;</code>,<code>&lt;select&gt;</code></td>
</tr>
<tr>
<td><code>@Param</code></td>
<td><code>Parameter</code></td>
<td></td>
</tr>
<tr>
<td><code>@SelectKey</code></td>
<td><code>Method</code></td>
<td><code>&lt;selectKey&gt;</code></td>
</tr>
<tr>
<td><code>@ResultMap</code></td>
<td><code>Method</code></td>
<td></td>
</tr>
<tr>
<td><code>@ResultType</code></td>
<td><code>Method</code></td>
<td>N</td>
</tr>
</tbody>
</table>
</div>
<h5 id="映射注解申明sql样例"><a href="#映射注解申明sql样例" class="headerlink" title="映射注解申明sql样例"></a>映射注解申明sql样例</h5><p>这些函数名相当于XML中的id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ClusterMessageMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Insert</span></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into cluster_manager(cluster_name, cluster_time, cluster_address, cluster_access_user, cluster_access_passwd) "</span> +</span><br><span class="line">            <span class="string">"values(#&#123;clusterName&#125;, #&#123;clusterTime&#125;, #&#123;clusterAddress&#125;, #&#123;clusterAccessUser&#125;, #&#123;clusterAccessPasswd&#125;)"</span>)</span><br><span class="line">    <span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>, keyColumn = <span class="string">"cluster_id"</span>, keyProperty = <span class="string">"clusterId"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertClusterMessage</span><span class="params">(ClusterMessage clusterMessage)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// select</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from cluster_manager"</span>)</span><br><span class="line">    <span class="meta">@Results</span>(</span><br><span class="line">            id = <span class="string">"clusterMessage"</span>,</span><br><span class="line">            value = &#123;</span><br><span class="line">                    <span class="meta">@Result</span>(column = <span class="string">"cluster_name"</span>, property = <span class="string">"clusterName"</span>, javaType = String.class, jdbcType = JdbcType.VARCHAR),</span><br><span class="line">                    <span class="meta">@Result</span>(column = <span class="string">"cluster_time"</span>, property = <span class="string">"clusterTime"</span>, javaType = Long.class, jdbcType = JdbcType.BIGINT),</span><br><span class="line">                    <span class="meta">@Result</span>(column = <span class="string">"cluster_address"</span>, property = <span class="string">"clusterAddress"</span>, javaType = String.class, jdbcType = JdbcType.VARCHAR),</span><br><span class="line">                    <span class="meta">@Result</span>(column = <span class="string">"cluster_access_user"</span>, property = <span class="string">"clusterAccessUser"</span>, javaType = String.class, jdbcType = JdbcType.VARCHAR),</span><br><span class="line">                    <span class="meta">@Result</span>(column = <span class="string">"cluster_access_passwd"</span>, property = <span class="string">"clusterAccessPasswd"</span>, javaType = String.class, jdbcType = JdbcType.VARCHAR)</span><br><span class="line">            &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ClusterMessage&gt; <span class="title">getClusterMessage</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from cluster_manager"</span>)</span><br><span class="line">    <span class="meta">@MapKey</span>(<span class="string">"clusterId"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Integer, ClusterMessage&gt; <span class="title">getClusterMessageMapper</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from cluster_manager where cluster_id=#&#123;clusterId&#125;"</span>)</span><br><span class="line">    <span class="meta">@ResultMap</span>(<span class="string">"clusterMessage"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClusterMessage <span class="title">getClusterMessageById</span><span class="params">(@Param(<span class="string">"clusterId"</span>)</span> <span class="keyword">int</span> clusterId)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// update</span></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update cluster_manager set cluster_name=#&#123;clusterName&#125; where cluster_id=#&#123;clusterId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateClusterMessage</span><span class="params">(ClusterMessage clusterMessage)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete</span></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from cluster_manager where cluster_id=#&#123;clusterId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteClusterMessage</span><span class="params">(@Param(<span class="string">"clusterId"</span>)</span><span class="keyword">int</span> clusterId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调用定义的SQL"><a href="#调用定义的SQL" class="headerlink" title="调用定义的SQL"></a>调用定义的SQL</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、获得 SqlSessionFactory</span></span><br><span class="line">String resource = <span class="string">"sqlMapConfig.xml"</span>;           <span class="comment">// 定位核心配置文件</span></span><br><span class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、获得 SqlSession</span></span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();   </span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、调用在 mapper 文件中配置的 SQL 语句</span></span><br><span class="line">List&lt;Person&gt; personList = sqlSession.selectList(<span class="string">"yeepay.payplus/mapper.UserMapper.findAll"</span>);</span><br><span class="line">Person p = sqlSession.selectOne(<span class="string">"yeepay.payplus.mapper.UserMapper.get"</span>, <span class="number">2</span>);</span><br><span class="line">sqlSession.insert(<span class="string">"yeepay.payplus.mapper.UserMapper.insert"</span>, p);</span><br><span class="line">sqlSession.insert(<span class="string">"yeepay.payplus.mapper.UserMapper.update"</span>, p);</span><br><span class="line">sqlSession.delete(<span class="string">"yeepay.payplus.mapper.UserMapper.deleteById"</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<h1 id="MyBatis-plus"><a href="#MyBatis-plus" class="headerlink" title="MyBatis-plus"></a>MyBatis-plus</h1><p>虽然mybatis可以直接在xml中通过SQL语句操作数据库，很是灵活。但正其操作都要通过SQL语句进行，就必须写大量的xml文件，很是麻烦。mybatis-plus就很好的解决了这个问题。</p>
<p>Mybatis-Plus（简称MP）是一个 Mybatis 的增强工具，在 Mybatis 的基础上只做增强不做改变，为简化开发、提高效率而生。其实就是它已经封装好了一些crud方法，我们不需要再写xml了，直接调用这些方法就行，就类似于JPA</p>
<h2 id="架构-2"><a href="#架构-2" class="headerlink" title="架构"></a>架构</h2><p><img alt="架构" data-src="//orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/mybatis-plus-framework.jpg" class="lazyload"></p>
<p><img alt="架构细节" data-src="//orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/mybatis-plus-framework-detail.jpg" class="lazyload"></p>
<h2 id="开发步骤-4"><a href="#开发步骤-4" class="headerlink" title="开发步骤"></a>开发步骤</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在 <code>application.yml</code> 配置文件中添加 H2 数据库的相关配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DataSource Config</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">org.h2.Driver</span></span><br><span class="line"><span class="attr">    schema:</span> <span class="attr">classpath:db/schema-h2.sql</span></span><br><span class="line"><span class="attr">    data:</span> <span class="attr">classpath:db/data-h2.sql</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:h2:mem:test</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>
<p>在 Spring Boot 启动类中添加 <code>@MapperScan</code> 注解，扫描 Mapper 文件夹：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.baomidou.mybatisplus.samples.quickstart.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(QuickStartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建Mapper类或Service类"><a href="#创建Mapper类或Service类" class="headerlink" title="创建Mapper类或Service类"></a>创建Mapper类或Service类</h3><h4 id="Mapper类"><a href="#Mapper类" class="headerlink" title="Mapper类"></a>Mapper类</h4><p>创建Mapper类继承BaseMapper类，BaseMapper类是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>通用 CRUD 封装<code>BaseMapper</code>接口，为 <code>Mybatis-Plus</code> 启动时自动解析实体表关系映射转换为 <code>Mybatis</code> 内部对象注入容器</li>
<li>泛型 <code>T</code> 为任意实体对象</li>
<li>参数 <code>Serializable</code> 为任意类型主键 <code>Mybatis-Plus</code> 不推荐使用复合主键约定每一张表都有自己的唯一 <code>id</code> 主键</li>
<li>对象 <code>Wrapper</code> 为条件构造器</li>
</ul>
</blockquote>
<h4 id="Service类"><a href="#Service类" class="headerlink" title="Service类"></a>Service类</h4><p>创建Service接口继承IService接口，创建Service类继承ServiceImpl类和Service接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.tp.mybatisplusstudy.vo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.tp.mybatisplusstudy.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.tp.mybatisplusstudy.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.tp.mybatisplusstudy.vo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">UserMapper</span>, <span class="title">User</span>&gt; <span class="keyword">implements</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:</p>
<ul>
<li>通用 Service CRUD 封装<code>IService</code>接口，进一步封装 CRUD 采用 <code>get 查询单行</code> <code>remove 删除</code> <code>list 查询集合</code> <code>page 分页</code> 前缀命名方式区分 <code>Mapper</code> 层避免混淆，</li>
<li>泛型 <code>T</code> 为任意实体对象</li>
<li>建议如果存在自定义通用 Service 方法的可能，请创建自己的 <code>IBaseService</code> 继承 <code>Mybatis-Plus</code> 提供的基类</li>
<li>对象 <code>Wrapper</code> 为条件构造器</li>
</ul>
</blockquote>
<h3 id="调用函数操纵数据库"><a href="#调用函数操纵数据库" class="headerlink" title="调用函数操纵数据库"></a>调用函数操纵数据库</h3><div class="table-container">
<table>
<thead>
<tr>
<th>Service CRUD 接口</th>
<th>Mapper CRUD 接口</th>
</tr>
</thead>
<tbody>
<tr>
<td>Save<br>SaveOrUpdate<br>Remove<br>Update<br>Get<br>List<br>Page<br>Count<br>Chain</td>
<td>Insert<br>Delete<br>Update<br>Select</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println((<span class="string">"----- selectAll method test ------"</span>));</span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectList(<span class="keyword">null</span>);    <span class="comment">// 使用了Mapper接口</span></span><br><span class="line">        Assert.assertEquals(<span class="number">5</span>, userList.size());</span><br><span class="line">        userList.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="https://www.cnblogs.com/dongguangming/p/12742533.html" target="_blank" rel="noopener">https://www.cnblogs.com/dongguangming/p/12742533.html</a></p>
<p><a href="https://blog.csdn.net/lonelymanontheway/article/details/83339837" target="_blank" rel="noopener">https://blog.csdn.net/lonelymanontheway/article/details/83339837</a></p>
<p><a href="https://blog.csdn.net/binqijiang9465/article/details/106993191/" target="_blank" rel="noopener">https://blog.csdn.net/binqijiang9465/article/details/106993191/</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">大橙砸</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/">https://orangesching.github.io/2020/08/25/Java/Java与数据库/Java操作关系型数据库/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://orangesching.github.io">大橙砸的日常记录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/概述/">概述    </a><a class="post-meta__tags" href="/tags/ORM框架/">ORM框架    </a><a class="post-meta__tags" href="/tags/JDBC/">JDBC    </a></div><div class="post_share"><div class="social-share" data-image="/img/cover/cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/08/31/Java/Java与数据库/MyBatis-plus/MyBatis-plus构造SQL/"><img class="prev_cover lazyload" data-src="/img/cover/cover2.gif" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>MyBatis-plus构造SQL</span></div></a></div><div class="next-post pull_right"><a href="/2020/08/24/其他/一些小工具/"><img class="next_cover lazyload" data-src="/img/cover/cover2.gif" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>一些小工具</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/08/24/其他/一些小工具/" title="一些小工具"><img class="relatedPosts_cover lazyload" data-src="/img/cover/cover2.gif"><div class="relatedPosts_title">一些小工具</div></a></div><div class="relatedPosts_item"><a href="/2021/04/28/版本控制工具/版本控制概述/" title="版本控制系统概述"><img class="relatedPosts_cover lazyload" data-src="/img/cover/cover2.gif"><div class="relatedPosts_title">版本控制系统概述</div></a></div><div class="relatedPosts_item"><a href="/2021/05/24/服务器配置与管理/Nginx/一、Nginx概述/" title="一、Nginx概述"><img class="relatedPosts_cover lazyload" data-src="/img/cover/cover.png"><div class="relatedPosts_title">一、Nginx概述</div></a></div><div class="relatedPosts_item"><a href="/2021/04/28/版本控制工具/Git/一、Git初识及简单使用/" title="一、Git初识及简单使用"><img class="relatedPosts_cover lazyload" data-src="/img/cover/cover2.gif"><div class="relatedPosts_title">一、Git初识及简单使用</div></a></div><div class="relatedPosts_item"><a href="/2020/08/19/数据库/非关系型数据库/Redis/Redis基础之一：Redis概述/" title="Redis基础之一：Redis概述"><img class="relatedPosts_cover lazyload" data-src="/img/cover/cover.png"><div class="relatedPosts_title">Redis基础之一：Redis概述</div></a></div><div class="relatedPosts_item"><a href="/2020/08/12/测试/测试技术/Mock技术/Mock技术概述/" title="Mock技术概述"><img class="relatedPosts_cover lazyload" data-src="/img/cover/cover2.gif"><div class="relatedPosts_title">Mock技术概述</div></a></div></div><div class="clear_both"></div></div></div></div><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By 大橙砸</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script async src="/js/search/local-search.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>
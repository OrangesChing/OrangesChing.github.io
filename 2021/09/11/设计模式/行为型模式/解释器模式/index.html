<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>解释器模式 | 大橙砸的日常记录</title><meta name="description" content="解释器模式"><meta name="keywords" content><meta name="author" content="大橙砸"><meta name="copyright" content="大橙砸"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon2.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="解释器模式"><meta name="twitter:description" content="解释器模式"><meta name="twitter:image" content="https://orangesching.github.io/img/cover/cover2.gif"><meta property="og:type" content="article"><meta property="og:title" content="解释器模式"><meta property="og:url" content="https://orangesching.github.io/2021/09/11/设计模式/行为型模式/解释器模式/"><meta property="og:site_name" content="大橙砸的日常记录"><meta property="og:description" content="解释器模式"><meta property="og:image" content="https://orangesching.github.io/img/cover/cover2.gif"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://orangesching.github.io/2021/09/11/设计模式/行为型模式/解释器模式/"><link rel="prev" title="适配器模式" href="https://orangesching.github.io/2022/02/11/设计模式/结构型模式/适配器模式/"><link rel="next" title="备忘录模式" href="https://orangesching.github.io/2021/09/10/设计模式/行为型模式/备忘录模式/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">大橙砸的日常记录</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/my.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">81</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">34</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#理论说明"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">理论说明</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#问题-动机"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">问题/动机</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#解决方案"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">解决方案</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#角色"><span class="toc_mobile_items-number">1.2.1.</span> <span class="toc_mobile_items-text">角色</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#关键实现"><span class="toc_mobile_items-number">1.2.2.</span> <span class="toc_mobile_items-text">关键实现</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#效果"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">效果</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#应用"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">应用</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#代码实现"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">代码实现</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#补充内容"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">补充内容</span></a></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#理论说明"><span class="toc-number">1.</span> <span class="toc-text">理论说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#问题-动机"><span class="toc-number">1.1.</span> <span class="toc-text">问题/动机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解决方案"><span class="toc-number">1.2.</span> <span class="toc-text">解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#角色"><span class="toc-number">1.2.1.</span> <span class="toc-text">角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关键实现"><span class="toc-number">1.2.2.</span> <span class="toc-text">关键实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#效果"><span class="toc-number">1.3.</span> <span class="toc-text">效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用"><span class="toc-number">1.4.</span> <span class="toc-text">应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代码实现"><span class="toc-number">2.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#补充内容"><span class="toc-number">3.</span> <span class="toc-text">补充内容</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/cover/cover2.gif)"><div id="post-info"><div id="post-title"><div class="posttitle">解释器模式</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-09-11<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-09-15</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/设计模式/">设计模式</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/设计模式/行为型模式/">行为型模式</a></span><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="理论说明"><a href="#理论说明" class="headerlink" title="理论说明"></a>理论说明</h1><p>写在前面的话：很多介绍解释器模式会从解释器开始说起（例如下述引用），这些都是对解释器的定义，解释器≠解释模式。个人在读的时候就被带跑偏了，认为解释模式就是把一个字符串按约定规则转化为对象或者类的工具（比如XML读取），<u>建议拉到代码实现先看测试代码的输入并不是一个字符串而是对象的组合</u>，就会马上明白，个人理解，解析器将字符串转化为对象之间的关系，解析器模式侧重在这些对象该如何表示与连接从而在上面跑一些功能。看的时候始终记住，你在学的是设计模式，不是算法，学的是怎么组织程序更科学合理</p>
<blockquote>
<p>如果一种特定类型的问题发生的频率足够高，那么可能就值得将该问题的各个实例表述为一个简单语言中的句子，这样就可以构建一个<strong>解释器</strong>，该解释器通过解释这些句子来解决该问题</p>
<p>比如编译原理中，一个算术表达式通过词法分析器形成词法单元，而后这些词法单元再通过语法分析器构建语法分析树，最终形成一颗抽象的语法分析树。诸如此类的例子也有很多，比如编译器、正则表达式等等</p>
<p>再比如有个游戏，玩家必须按照：移动方向+移动方式+移动距离这种格式输入我的指令，如输入<code>up walk 5</code>，而这种格式的指令就是一种文法，只有按照了我定义的这种文法去输入，才能控制屏幕上的小狗去移动。当然了，我输入<code>up walk 5</code>，程序无法直接通过字符串来控制小狗，这时就需要一个工具(解释器)去将我输入的内容翻译成程序能听懂的东西，解释器对我输入的指令进行解释，然后将解释得到的指令发送给屏幕上的小狗进行实际的移动</p>
</blockquote>
<h2 id="问题-动机"><a href="#问题-动机" class="headerlink" title="问题/动机"></a>问题/动机</h2><p>对于指定的文法规则，如何组织文法规则代码（如何用代码表示抽象语法树）来解释句子并执行响应功能，并需达到方便扩展的目的</p>
<blockquote>
<p><strong>背景知识：编译原理中的四个概念——文法、语言单位、句子、抽象语法树</strong></p>
<p><strong>文法：</strong>描述语言的语法结构的形式规则</p>
<p><strong>语言单位：</strong>分为<strong>终结符</strong>和<strong>非终结符</strong>，终结符是语言的最小组成单位，为不可分割的语言单位，非终结符由多个非终结符或终结符组成，每个非终结符表示一个终结符串的集合</p>
<p>以整数加减运算为例：</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; &lt;<span class="built_in">exp</span>&gt; := &lt;factor&gt; &#123;&lt;operation&gt; &lt;factor&gt;&#125;             </span><br><span class="line">&gt; &lt;factor&gt; := &lt;<span class="built_in">exp</span>&gt; | &lt;n&gt;</span><br><span class="line">&gt; &lt;operation&gt; := + | -  </span><br><span class="line">&gt; &lt;n&gt; := <span class="number">1</span>、<span class="number">2</span>、<span class="number">3</span>...n</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<ul>
<li>4条规则即一套语法规则，即文法</li>
<li>4条文法对应3个非终结符：<code>exp</code>、<code>factor</code>、<code>operation</code></li>
<li>4条文法对应n个终结符：<code>+</code>、<code>-</code>、<code>1</code>、<code>2</code>、<code>3</code>….</li>
</ul>
<p><strong>句子：</strong>符合文法并由终结符组成的语言单位串</p>
<p><strong>抽象语法树：</strong>：用图形方式来直观地表示语言的构成，<u>每一棵语法树对应一个语言实例</u>。所有的内节点都是非终结符、所有的叶子节点都是终结符</p>
<p><code>4 + 8 - 2</code>的抽象语法树如下：</p>
<p><img alt="抽象语法树" style="zoom:75%;" data-src="//orangesching.github.io/2021/09/11/设计模式/行为型模式/解释器模式/抽象语法树.png" class="lazyload"></p>
</blockquote>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h3><ul>
<li><strong>AbstractExpression（抽象表达式）：</strong>在抽象表达式中声明了抽象的解释操作，这个接口被抽象语法树中所有的节点所共享。它是所有终结符表达式和非终结符表达式的公共父类</li>
<li><strong>TerminalExpression（终结符表达式）：</strong>终结符表达式是抽象表达式的子类，它实现了与文法中的终结符相关联的解释操作，在句子中的每一个终结符都是该类的一个实例。通常在一个解释器模式中只有少数几个终结符表达式类，它们的实例可以通过非终结符表达式组成较为复杂的句子</li>
<li><strong>NonterminalExpression（非终结符表达式）：</strong>非终结符表达式是抽象表达式的子类，它实现了文法中非终结符的解释操作，由于在非终结符表达式中可以包含终结符表达式，也可以继续包含非终结符表达式，因此<u>其解释操作一般通过递归的方式来完成</u></li>
<li><strong>Context（环境类）：</strong>环境类又称为上下文类，它用于存储解释器之外的一些全局信息，通常它临时存储了需要解释的语句</li>
</ul>
<p><img alt="解释器模式的结构图" data-src="//orangesching.github.io/2021/09/11/设计模式/行为型模式/解释器模式/OrangeBlog\source\_draft\设计模式\行为型模式\解释器模式\3-1Q119150626422.gif" class="lazyload"></p>
<h3 id="关键实现"><a href="#关键实现" class="headerlink" title="关键实现"></a>关键实现</h3><p>定义一套语法规则，也称为文法。将文法规则分为终结符表达式和非终结符表达式，封装成指定的类</p>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>优点：</p>
<ol>
<li>扩展性好。由于在解释器模式中使用类来表示语言的文法规则，因此可以通过继承等机制来改变或扩展文法</li>
<li>容易实现。在语法树中的每个表达式节点类都是相似的，所以实现其文法较为容易</li>
</ol>
<p>缺点：</p>
<ol>
<li>执行效率较低。解释器模式中通常使用大量的循环和递归调用，当要解释的句子较复杂时，其运行速度很慢，且代码的调试过程也比较麻烦</li>
<li>会引起类膨胀。解释器模式中的每条规则至少需要定义一个类，当包含的文法规则很多时，类的个数将急剧增加，导致系统难以管理与维护</li>
<li>可应用的场景比较少。在软件开发中，需要定义语言文法的应用实例非常少，所以这种模式很少被使用到</li>
</ol>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>解释器模式为自定义语言的设计和实现提供了一种解决方案，它用于定义一组文法规则并通过这组文法规则来解释语言中的句子。虽然解释器模式的使用频率不是特别高，但是它在正则表达式<strong>、</strong>XML文档解释等领域还是得到了广泛使用</p>
<p>适用场景：</p>
<ul>
<li>可以将一个需要解释执行的语言中的句子表示为一个抽象语法树</li>
<li>一些重复出现的问题可以用一种简单的语言来进行表达</li>
<li>一个语言的文法较为简单</li>
<li>执行效率不是关键问题</li>
</ul>
<p>如：</p>
<p><code>Spring EL</code>表达式</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><p>以上述加减运算为例，终止符表达式为数字，非终止表达式为加减操作符</p>
<p>抽象表达式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Expression_AbstractExpression</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">interpret</span><span class="params">(Context context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>终止符表达式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Number_TerminalExpression</span> <span class="keyword">implements</span>  <span class="title">Expression_AbstractExpression</span></span>&#123;</span><br><span class="line">    String variable;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Number_TerminalExpression</span><span class="params">(String variable)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.variable = variable;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">interpret</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> context.lookup(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>非终止符表达式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlusOperation_NonTerminalExpression</span>  <span class="keyword">implements</span> <span class="title">Expression_AbstractExpression</span></span>&#123;</span><br><span class="line">    Expression_AbstractExpression e1,e2;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlusOperation_NonTerminalExpression</span><span class="params">(Expression_AbstractExpression e1, Expression_AbstractExpression e2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.e1 = e1;</span><br><span class="line">        <span class="keyword">this</span>.e2 = e2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将两个表达式相减</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">interpret</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.e1.interpret(context) + <span class="keyword">this</span>.e2.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinusOperation_NonTerminalExpression</span> <span class="keyword">implements</span> <span class="title">Expression_AbstractExpression</span></span>&#123;</span><br><span class="line">    Expression_AbstractExpression e1,e2;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinusOperation_NonTerminalExpression</span><span class="params">(Expression_AbstractExpression e1, Expression_AbstractExpression e2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.e1 = e1;</span><br><span class="line">        <span class="keyword">this</span>.e2 = e2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将两个表达式相减</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">interpret</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.e1.interpret(context) - <span class="keyword">this</span>.e2.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>环境类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Expression_AbstractExpression, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义变量</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Expression_AbstractExpression s, Integer value)</span></span>&#123;</span><br><span class="line">        map.put(s, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将变量转换成数字</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lookup</span><span class="params">(Expression_AbstractExpression s)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> map.get(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Context context = <span class="keyword">new</span> Context();</span><br><span class="line">        Number_TerminalExpression a = <span class="keyword">new</span> Number_TerminalExpression(<span class="string">"a"</span>);</span><br><span class="line">        Number_TerminalExpression b = <span class="keyword">new</span> Number_TerminalExpression(<span class="string">"b"</span>);</span><br><span class="line">        Number_TerminalExpression c = <span class="keyword">new</span> Number_TerminalExpression(<span class="string">"c"</span>);</span><br><span class="line">        context.add(a, <span class="number">4</span>);</span><br><span class="line">        context.add(b, <span class="number">8</span>);</span><br><span class="line">        context.add(c, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        PlusOperation_NonTerminalExpression plus = <span class="keyword">new</span> PlusOperation_NonTerminalExpression(a,b);</span><br><span class="line">        MinusOperation_NonTerminalExpression minus = <span class="keyword">new</span> MinusOperation_NonTerminalExpression(plus,c);</span><br><span class="line"></span><br><span class="line">        System.out.println(minus.interpret(context));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>
<h1 id="补充内容"><a href="#补充内容" class="headerlink" title="补充内容"></a>补充内容</h1><p><strong>可以看出上述的测试类输入为表达式类的拼接，其实相当于自己构建了抽象语法树，你可能会唏嘘，谁会这么输入，抽象树还要我自己建，这时将字符串转化为类似抽象树的操作就是解析器做的事了，以下是加入了解析器后的代码，但是解析器不属于解析器模式的一部分</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Expression, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Expression s, Integer value)</span></span>&#123;</span><br><span class="line">        map.put(s, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">lookup</span><span class="params">(Expression s)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> map.get(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//构建语法树的主要方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Expression <span class="title">build</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//主要利用栈来实现</span></span><br><span class="line">        Stack&lt;Expression&gt; objects = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">char</span> c = str.charAt(i);</span><br><span class="line">            <span class="comment">//遇到运算符号+号时候</span></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">'+'</span>)&#123;</span><br><span class="line">    </span><br><span class="line">                <span class="comment">//先出栈</span></span><br><span class="line">                Expression pop = objects.pop();</span><br><span class="line">    </span><br><span class="line">                <span class="comment">//将运算结果入栈</span></span><br><span class="line">                objects.push(<span class="keyword">new</span> PlusOperation(pop, <span class="keyword">new</span> TerminalExpression(String.valueOf(str.charAt(++i)))));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">'-'</span>)&#123;</span><br><span class="line">                <span class="comment">//遇到减号类似加号</span></span><br><span class="line">                Expression pop = objects.pop();</span><br><span class="line">    </span><br><span class="line">                objects.push(<span class="keyword">new</span> MinusOperation(pop, <span class="keyword">new</span> TerminalExpression(String.valueOf(str.charAt(++i)))));</span><br><span class="line">    </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//遇到非终结符直接入栈（基本就是第一个数字的情况）</span></span><br><span class="line">                objects.push(<span class="keyword">new</span> TerminalExpression(String.valueOf(str.charAt(i))));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//把最后的栈顶元素返回</span></span><br><span class="line">        <span class="keyword">return</span> objects.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TerminalExpression</span> <span class="keyword">implements</span> <span class="title">Expression</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String variable;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TerminalExpression</span><span class="params">(String variable)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">this</span>.variable = variable;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">interpreter</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//因为要兼容之前的版本</span></span><br><span class="line">        Integer lookup = context.lookup(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (lookup == <span class="keyword">null</span>)</span><br><span class="line">            <span class="comment">//若在map中能找到对应的数则返回</span></span><br><span class="line">            <span class="keyword">return</span> Integer.valueOf(variable);</span><br><span class="line">        <span class="comment">//找不到则直接返回（认为输入的就是数字）</span></span><br><span class="line">        <span class="keyword">return</span> lookup;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Context context = <span class="keyword">new</span> Context();</span><br><span class="line">        TerminalExpression a = <span class="keyword">new</span> TerminalExpression(<span class="string">"a"</span>);</span><br><span class="line">        TerminalExpression b = <span class="keyword">new</span> TerminalExpression(<span class="string">"b"</span>);</span><br><span class="line">        TerminalExpression c = <span class="keyword">new</span> TerminalExpression(<span class="string">"c"</span>);</span><br><span class="line">        String str = <span class="string">"4+8-2+9+9-8"</span>;</span><br><span class="line">        Expression build = Context.build(str);</span><br><span class="line">        System.out.println(<span class="string">"4+8-2+9+9-8="</span> + build.interpreter(context));</span><br><span class="line">    </span><br><span class="line">        context.add(a, <span class="number">4</span>);</span><br><span class="line">        context.add(b, <span class="number">8</span>);</span><br><span class="line">        context.add(c, <span class="number">2</span>);</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="keyword">new</span> MinusOperation(<span class="keyword">new</span> PlusOperation(a,b), c).interpreter(context));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">运行结果如下</span><br><span class="line"><span class="number">4</span>+<span class="number">8</span>-<span class="number">2</span>+<span class="number">9</span>+<span class="number">9</span>-<span class="number">8</span>=<span class="number">20</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="https://blog.csdn.net/niunai112/article/details/79982712" target="_blank" rel="noopener">https://blog.csdn.net/niunai112/article/details/79982712</a></p>
<p><a href="https://www.jianshu.com/p/7e23cca5ff8c" target="_blank" rel="noopener">https://www.jianshu.com/p/7e23cca5ff8c</a></p>
<p><a href="https://whirlys.blog.csdn.net/article/details/86444352" target="_blank" rel="noopener">https://whirlys.blog.csdn.net/article/details/86444352</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">大橙砸</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://orangesching.github.io/2021/09/11/设计模式/行为型模式/解释器模式/">https://orangesching.github.io/2021/09/11/设计模式/行为型模式/解释器模式/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://orangesching.github.io">大橙砸的日常记录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/cover/cover2.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2022/02/11/设计模式/结构型模式/适配器模式/"><img class="prev_cover lazyload" data-src="/img/cover/cover.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>适配器模式</span></div></a></div><div class="next-post pull_right"><a href="/2021/09/10/设计模式/行为型模式/备忘录模式/"><img class="next_cover lazyload" data-src="/img/cover/cover.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>备忘录模式</span></div></a></div></nav></div></div><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2022 By 大橙砸</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script async src="/js/search/local-search.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>